# OpenAPI 3.1 Template following API Design Patterns (JJ Geewax)
# This template follows resource-oriented design principles

openapi: 3.1.0
info:
  title: {{API_NAME}} API
  description: |
    {{API_DESCRIPTION}}

    ## Resource-Oriented Design
    This API follows resource-oriented design principles where resources (nouns)
    are the fundamental building blocks, operated on by standard methods (verbs).
  version: "1.0.0"
  contact:
    name: API Support
    email: api-support@example.com

servers:
  - url: https://api.example.com/v1
    description: Production server
  - url: https://api-staging.example.com/v1
    description: Staging server

tags:
  - name: {{resource_plural}}
    description: Operations on {{resource_plural}} resources

paths:
  # ============================================
  # COLLECTION RESOURCE: /{{resource_plural}}
  # ============================================
  /{{resource_plural}}:
    # LIST - Get collection of resources
    get:
      tags:
        - {{resource_plural}}
      summary: List {{resource_plural}}
      description: Returns a paginated list of {{resource_plural}}
      operationId: list{{ResourcePlural}}
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/PageToken'
        - $ref: '#/components/parameters/Filter'
        - $ref: '#/components/parameters/OrderBy'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/List{{ResourcePlural}}Response'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

    # CREATE - Create a new resource
    post:
      tags:
        - {{resource_plural}}
      summary: Create a {{resource_singular}}
      description: Creates a new {{resource_singular}} resource
      operationId: create{{ResourceSingular}}
      parameters:
        - $ref: '#/components/parameters/RequestId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Create{{ResourceSingular}}Request'
      responses:
        '201':
          description: Resource created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/{{ResourceSingular}}'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================
  # INDIVIDUAL RESOURCE: /{{resource_plural}}/{id}
  # ============================================
  /{{resource_plural}}/{{{resource_singular}}_id}:
    parameters:
      - $ref: '#/components/parameters/{{ResourceSingular}}Id'

    # GET - Retrieve a single resource
    get:
      tags:
        - {{resource_plural}}
      summary: Get a {{resource_singular}}
      description: Retrieves a single {{resource_singular}} by ID
      operationId: get{{ResourceSingular}}
      parameters:
        - $ref: '#/components/parameters/ReadMask'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/{{ResourceSingular}}'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    # UPDATE - Full update of a resource
    put:
      tags:
        - {{resource_plural}}
      summary: Update a {{resource_singular}}
      description: Fully updates an existing {{resource_singular}}
      operationId: update{{ResourceSingular}}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/{{ResourceSingular}}'
      responses:
        '200':
          description: Resource updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/{{ResourceSingular}}'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    # PARTIAL UPDATE - Partial update using field mask
    patch:
      tags:
        - {{resource_plural}}
      summary: Partially update a {{resource_singular}}
      description: Partially updates a {{resource_singular}} using field mask
      operationId: patch{{ResourceSingular}}
      parameters:
        - $ref: '#/components/parameters/UpdateMask'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/{{ResourceSingular}}'
      responses:
        '200':
          description: Resource updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/{{ResourceSingular}}'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    # DELETE - Remove a resource
    delete:
      tags:
        - {{resource_plural}}
      summary: Delete a {{resource_singular}}
      description: Deletes a {{resource_singular}} (soft delete by default)
      operationId: delete{{ResourceSingular}}
      responses:
        '204':
          description: Resource deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================
  # CUSTOM METHODS
  # ============================================
  /{{resource_plural}}/{{{resource_singular}}_id}:undelete:
    parameters:
      - $ref: '#/components/parameters/{{ResourceSingular}}Id'
    post:
      tags:
        - {{resource_plural}}
      summary: Restore a deleted {{resource_singular}}
      description: Restores a soft-deleted {{resource_singular}}
      operationId: undelete{{ResourceSingular}}
      responses:
        '200':
          description: Resource restored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/{{ResourceSingular}}'
        '404':
          $ref: '#/components/responses/NotFound'

  # ============================================
  # BATCH OPERATIONS
  # ============================================
  /{{resource_plural}}:batchGet:
    get:
      tags:
        - {{resource_plural}}
      summary: Batch get {{resource_plural}}
      description: Retrieves multiple {{resource_plural}} by their IDs
      operationId: batchGet{{ResourcePlural}}
      parameters:
        - name: ids
          in: query
          description: Comma-separated list of resource IDs
          required: true
          schema:
            type: string
            example: "id1,id2,id3"
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchGet{{ResourcePlural}}Response'

components:
  # ============================================
  # PARAMETERS
  # ============================================
  parameters:
    {{ResourceSingular}}Id:
      name: {{resource_singular}}_id
      in: path
      required: true
      description: Unique identifier for the {{resource_singular}}
      schema:
        type: string
        example: "abc123"

    PageSize:
      name: page_size
      in: query
      description: Maximum number of results to return (1-100, default 25)
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 25

    PageToken:
      name: page_token
      in: query
      description: Token for pagination (from previous response)
      schema:
        type: string

    Filter:
      name: filter
      in: query
      description: |
        Filter expression using Common Expression Language (CEL).
        Example: `status = "ACTIVE" AND created_at > "2024-01-01"`
      schema:
        type: string

    OrderBy:
      name: order_by
      in: query
      description: |
        Sort order. Use field name with optional `desc` suffix.
        Example: `created_at desc`
      schema:
        type: string

    ReadMask:
      name: read_mask
      in: query
      description: |
        Comma-separated list of fields to return.
        Example: `name,status,created_at`
      schema:
        type: string

    UpdateMask:
      name: update_mask
      in: query
      description: |
        Comma-separated list of fields to update.
        Example: `display_name,status`
      schema:
        type: string

    RequestId:
      name: X-Request-Id
      in: header
      description: Unique request ID for idempotency
      schema:
        type: string
        format: uuid

  # ============================================
  # SCHEMAS
  # ============================================
  schemas:
    # Base Resource Schema
    {{ResourceSingular}}:
      type: object
      properties:
        name:
          type: string
          description: Full resource name
          example: "{{resource_plural}}/abc123"
          readOnly: true
        id:
          type: string
          description: Unique resource identifier
          example: "abc123"
          readOnly: true
        display_name:
          type: string
          description: Human-readable name
          maxLength: 255
        # Add your resource-specific fields here
        created_at:
          type: string
          format: date-time
          description: Creation timestamp (RFC 3339)
          readOnly: true
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp (RFC 3339)
          readOnly: true
        delete_time:
          type: string
          format: date-time
          description: Soft deletion timestamp (null if not deleted)
          readOnly: true
      required:
        - display_name

    # Create Request (excludes read-only fields)
    Create{{ResourceSingular}}Request:
      type: object
      properties:
        display_name:
          type: string
          description: Human-readable name
          maxLength: 255
        # Add your create-specific fields here
      required:
        - display_name

    # List Response with Pagination
    List{{ResourcePlural}}Response:
      type: object
      properties:
        {{resource_plural}}:
          type: array
          items:
            $ref: '#/components/schemas/{{ResourceSingular}}'
        next_page_token:
          type: string
          description: Token to retrieve next page (empty if last page)
        total_size:
          type: integer
          description: Total number of resources matching the query

    # Batch Get Response
    BatchGet{{ResourcePlural}}Response:
      type: object
      properties:
        {{resource_plural}}:
          type: array
          items:
            $ref: '#/components/schemas/{{ResourceSingular}}'

    # Standard Error Response
    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              description: HTTP status code
            status:
              type: string
              description: Error status code
              enum:
                - INVALID_ARGUMENT
                - NOT_FOUND
                - ALREADY_EXISTS
                - PERMISSION_DENIED
                - UNAUTHENTICATED
                - RESOURCE_EXHAUSTED
                - INTERNAL
                - UNAVAILABLE
            message:
              type: string
              description: Human-readable error message
            details:
              type: array
              items:
                type: object
                properties:
                  "@type":
                    type: string
                  field:
                    type: string
                  description:
                    type: string

  # ============================================
  # RESPONSES
  # ============================================
  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: 400
              status: INVALID_ARGUMENT
              message: "Invalid field value"

    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: 401
              status: UNAUTHENTICATED
              message: "Missing or invalid authentication"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: 404
              status: NOT_FOUND
              message: "Resource not found"

    Conflict:
      description: Resource conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: 409
              status: ALREADY_EXISTS
              message: "Resource already exists"

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: 500
              status: INTERNAL
              message: "Internal server error"

  # ============================================
  # SECURITY
  # ============================================
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

security:
  - BearerAuth: []
  - ApiKeyAuth: []
